with Seq(#a|#b)
def bare() {
    alt _ {
        _ => {
            #a
        }
        _ => {
            #b
        }
    }
}

test @up(Seq(#a|#b)) { #a } bare();

with Seq(#a|#b)
def simple(): Seq(#a | #b) {
    on x {
        alt x {
            #a => {
                #a
                #b
            }
            #b => {
                #b
                #a
            }
        }
    }
}

test @both(Seq(#a|#b)) { #b; #a } simple() { #b };
test @both(Seq(#a|#b)) { #a; #b } simple() { #a };

with Seq(#a|#b|#x|#y)
def tuple(): Seq(#a|#b, #a|#b|#x|#y) {
    on z {
        alt z {
            (#a, w) => {
                #a
                w
            }
            (#b, w) => {
                #b
                w
            }
        }
    }
}

test @both(Seq(#a|#b|#x|#y)) { #b; #x } tuple() { (#b, #x) };

with Seq(#a|#b)
def ambiguous(): Seq(#a | #b) {
    on x {
        alt x {
            #b => {
                #a
                #b
                #a
            }
            #a => {
                #a
                #a
                #b
            }
        }
    }
}

test @both(Seq(#a|#b)) { #a; #b; #a } ambiguous() { #b };
test @both(Seq(#a|#b)) { #a; #a; #b } ambiguous() { #a };
test fail @both(Seq(#a|#b)) { #a; #a; #a } ambiguous() { #a };
