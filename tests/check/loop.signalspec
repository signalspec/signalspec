let t = #a|#b|#c|#d

with Seq(t, dir)
def main(var(dir) x) = {
    val(#a)
    val(#b)
    repeat x {
        val(#c)
        val(#d)
    }
    val(#a)
}

test @both(Seq(t, _)) { val(#a) ; val(#b) ; val(#a) } | main(0);
test fail @up(Seq(t, _)) { val(#a) ; val(#b) ; val(#a) } | main(1);
test @both(Seq(t, _)) { val(#a) ; val(#b) ; val(#c) ; val(#d) ; val(#a) } | main(1);
test @both(Seq(t, _)) { val(#a) ; val(#b) ; val(#c) ; val(#d) ; val(#c) ; val(#d) ; val(#a) } | main(2);
test fail @up(Seq(t, _)) { val(#a) ; val(#b) ; val(#c) ; val(#a) } | main(_);
test fail @up(Seq(t, _)) { val(#a) ; val(#b) ; val(#c) ; val(#d) } | main(_);
